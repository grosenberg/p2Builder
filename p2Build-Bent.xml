<?xml version="1.0" encoding="UTF-8"?>
<project default="p2Build" name="p2Build" basedir="../net.certiv.bent.ui.win32.feature">

	<!-- Preliminaries -->
	<property file="D:/DevFiles/Java/WorkSpaces/Main/net.certiv.certivtools.build/Action.properties" />
	<include file="D:/DevFiles/Java/WorkSpaces/Main/net.certiv.certivtools.build/ActionLib.xml" />

	<!-- Custom values -->
	<property name="srcRepo" value="${def.srcRepo}" />
	<property name="dstRepo" value="${def.dstRepo}" />
	<property name="configName" value="${ui}/BentUI.pro" />

	<property name="dir32" value="../net.certiv.bent.ui.win32.x86" />
	<property name="dir64" value="../net.certiv.bent.ui.win32" />

	<property name="ui" value="net.certiv.bent.ui.win32" />
	<property name="x86" value="net.certiv.bent.ui.win32.x86" />
	<property name="core" value="net.certiv.bent.core.win32" />


	<target name="p2Build">

		<!-- Set up the build directory -->
		<cleanBuildDir />

		<!-- Prep the build directory -->
		<preBuild features="net.certiv.bent.core.win32.feature, net.certiv.bent.ui.win32.feature"
		          plugins="net.certiv.bent.core.win32, net.certiv.bent.ui.win32" />

		<!-- Run the PDE build for x86_64 features -->
		<build features="net.certiv.bent.ui.win32.feature" b.arch="x86_64" configs="win32,win32,x86_64" />

		<!-- Reset the build directory -->
		<cleanBuildDir />

		<!-- Generate the src for the 32bit version -->
		<gen32bitProject dir64="${dir64}" dir32="${dir32}" />

		<!-- Prep the build directory -->
		<preBuild features="net.certiv.bent.core.win32.feature, net.certiv.bent.ui.win32.x86.feature"
		          plugins="net.certiv.bent.core.win32, net.certiv.bent.ui.win32.x86" />

		<!-- Run the PDE build for x86 features -->
		<build features="net.certiv.bent.ui.win32.x86.feature"
		       b.arch="x86"
		       configs="win32,win32,x86"
		       e.home="${ct.eclipse_x86.home}"
		       j.home="${ct.java_x86.home}" />

		<!-- Clean out the src for the 32bit version -->
		<delete>
			<fileset dir="${dir32}/src" includes="**/*.java **/*.class" />
		</delete>

		<!-- Perform post processing to optimize the jars -->
		<generate repo="${srcRepo}" />
		<categorize repo="${srcRepo}" />
		<refresh wsDir="${srcRepo}" />

		<publish feature="${ui}.feature" />
		<publish feature="${x86}.feature" />
		<publish feature="${core}.feature" />

		<echo>Optimizing ${ui}</echo>
		<proguarddt config="${configName}" plugin1="${ui}" plugin2="${x86}" plugin3="${core}" />

		<echo>Processing repository at "${dstRepo}"</echo>
		<generate repo="${dstRepo}" />
		<categorize repo="${dstRepo}" />
		<refresh wsDir="${dstRepo}" />
	</target>
</project>